created: 20190310072223522
modified: 20190722110643359
title: $:/plugins/rimi/appify/macros
type: text/vnd.tiddlywiki

\define appifyTitlesBasePrefix() $:/appify/apps/

\define resolveAppName(appName) <$reveal text="$appName$" default="" type="match"><<appify.activeAppName>></$reveal><$reveal text="$appName$" default="" type="nomatch">$appName$</$reveal>

\define resolveThemeName(themeName) <$reveal text="$themeName$" default="" type="match"><<appify.activeThemeName>></$reveal><$reveal text="$themeName$" default="" type="nomatch">$themeName$</$reveal>

\define resolveStyleName(styleName) <$reveal text="$styleName$" default="" type="match"><<appify.activeStyleName>></$reveal><$reveal text="$styleName$" default="" type="nomatch">$styleName$</$reveal>

\define resolveLangName(langName) <$reveal text="$langName$" default="" type="match"><<appify.activeLangName>></$reveal><$reveal text="$langName$" default="" type="nomatch">$langName$</$reveal>

\define resolveViewTitle(viewTitle) <$reveal text="$viewTitle$" default="" type="match"><<appify.viewTitle>></$reveal><$reveal text="$viewTitle$" default="" type="nomatch">$viewTitle$</$reveal>

\define themeFolder(appName, themeName) <<appifyTitlesBasePrefix>><<resolveAppName "$appName$">>/themes/<<resolveThemeName "$themeName$">>

\define themeViewTitle(appName, themeName) <<themeFolder "$appName$" "$themeName$">>/<<resolveLangName>>

\define sectionFolder(id, appName:"") <<appifyTitlesBasePrefix>><<resolveAppName "$appName$">>/sections/$id$

\define sectionViewTitle(id, appName:"") <<sectionFolder "$id$" "$appName$">>/<<resolveLangName>>

\define styleTitle(viewTitle, styleName:"") <<appify.sectionFolder>>/styles/<<resolveStyleName "$styleName$">>

\define macroTitle(viewTitle) <<appify.sectionFolder>>/macro

\define sectionId(id) <<resolveAppName>>-section-$id$

\define renderSection(id)
<$set name="appify.componentType" value="section">
<$set name="appify.sectionId" value="$id$">
<$wikify name="appify.sectionConfigDynDataFieldName" text="""appify.dyn-data.<<appify.sectionId>>""">
<$wikify name="appify.sectionDynData" text="""<$view tiddler=<<appify.activeConfig>> field=<<appify.sectionConfigDynDataFieldName>>/>""">
<$wikify name="appify.sectionConfigDynDataRegognizedTagsFieldName" text="""appify.dyn-data.<<appify.sectionId>>.recognized-tags""">
<$wikify name="appify.sectionDynDataRegognizedTags" text="""<$view tiddler=<<appify.activeConfig>> field=<<appify.sectionConfigDynDataRegognizedTagsFieldName>>/>""">
<$wikify name="appify.divId" text=<<sectionId "$id$">>>
<$wikify name="appify.sectionFolder" text=<<sectionFolder "$id$">>>
<$wikify name="appify.sectionDynTemplates" text=<<calcDynTemplates>>>
<div id=<<appify.divId>>><$wikify name="currentTiddler" text=<<sectionViewTitle "$id$">>><$set name="appify.viewTitle" value=<<currentTiddler>>><$wikify name="appify.styleTitle" text=<<styleTitle>>><$wikify name="appify.macroTitle" text=<<macroTitle>>><$macrocall $name="editSectionButton" sectionId="$id$"/>{{||$:/plugins/rimi/appify/ActiveComponentRenderer}}</$wikify></$wikify></$set></$wikify></div>
</$wikify>
</$wikify>
</$wikify>
</$wikify>
</$wikify>
</$wikify>
</$wikify>
</$set>
</$set>
\end

\define calcDynTemplates()
<$set name="appify.sectionDynData" value=<<appify.sectionDynData>> emptyValue="constants/default">
<$list filter="[enlist<appify.sectionDynData>]">
<$list filter="[<currentTiddler>prefix[constants/]]">
<<appify.sectionFolder>>/templates/<<currentTiddler>>/<<appify.activeLangName>>
</$list>
<$list filter="[<currentTiddler>!prefix[constants/]]">
<$list filter="[<currentTiddler>is[tiddler]]">
<$list filter="[<currentTiddler>tags[]]" variable="tagName">
<$list filter="[enlist<appify.sectionDynDataRegognizedTags>prefix<tagName>]">
<<appify.sectionFolder>>/templates/based-on-tags/<<tagName>>
</$list>
</$list>
</$list>
</$list>
</$list>
</$set>
\end

\define editComponentButton()

<$button tooltip="Edit Content">
<$action-sendmessage $message=<<appify.activeEditMode>> $param="$:/plugins/rimi/appify/edit-active-component" appify.viewTitle=<<appify.viewTitle>> appify.styleTitle=<<appify.styleTitle>> appify.availableStyles=<<appify.availableStyles>> appify.macroTitle=<<appify.macroTitle>> appify.activeEditMode=<<appify.activeEditMode>>/>
{{$:/core/images/options-button}}
</$button>

\end

\define editCurrentTemplateButton(tooltip:"") <$macrocall $name="editTemplateButton" templateTiddler=<<currentTiddler>> tooltip="$tooltip$"/>

\define editTemplateButton(templateTiddler, tooltip:"")

<$reveal type="match" state="$:/state/rimi/dev-mode" text="on" default="off">
<$button tooltip="$tooltip$">
<$action-sendmessage $message=<<appify.activeEditMode>> $param="$:/plugins/rimi/appify/templates/edit-template-tiddler" templateTiddler="$templateTiddler$"/>
{{$:/core/images/storyview-classic}}
</$button>
</$reveal>

\end

\define editCurrent(tooltip:"")

<$reveal type="match" state="$:/state/rimi/dev-mode" text="on" default="off">
<$button tooltip="$tooltip$">
<$action-sendmessage $message=<<appify.activeEditMode>> $param="$:/plugins/rimi/appify/templates/edit-template-tiddler" templateTiddler=<<currentTiddler>>/>
{{$:/core/images/edit-button}}
</$button>
</$reveal>

\end

\define editAppifyConfig()

<$reveal type="match" state="$:/state/rimi/dev-mode" text="on" default="off">
<$button tooltip="Configure Appify">
<$action-sendmessage $message=<<appify.activeEditMode>>} $param="$:/plugins/rimi/appify/description" appify.activeConfig=<<appify.activeConfig>>/>
{{$:/core/images/star-filled}}
</$button>
</$reveal>

\end